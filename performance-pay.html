<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Performance Pay Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body{
    margin:0;
    background:#000080;
    color:#eef1f7;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    padding:16px;
  }
  .wrap{max-width:1200px;margin:auto}
  .card{
    background:#14161c;
    border:1px solid #242836;
    border-radius:14px;
    padding:14px;
    margin-bottom:12px;
  }
  .row{
  display:grid;
  grid-template-columns:repeat(12,1fr);
  gap:18px;         
  align-items:end;

  }
  label{font-size:12px;color:#a7adbb;margin-bottom:6px;display:block}
  input{
    width:100%;
    padding:10px;
    border-radius:14px;
    border:1px solid #242836;
    background:#0f1117;
    color:#eef1f7;
  }
  button{
    padding:10px 12px;
    border-radius:12px;
    border:1px solid #242836;
    background:#1a2030;
    color:#fff;
    cursor:pointer;
  }
  button.secondary{background:#0f1117}
  button.small{padding:6px 10px}
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
    border-radius:12px;
    overflow:hidden;
  }
  th,td{
    border-bottom:1px solid #242836;
    padding:10px;
    font-size:13px;
    vertical-align:top;
  }
  th{background:#10131b;color:#a7adbb;text-align:left}
  .right{text-align:right}
  .muted{color:#a7adbb}
  .good{color:#2ee59d}
  .bad{color:#ff6b6b}
  .btnbar{display:flex;gap:10px;flex-wrap:wrap}

  @media (max-width:900px){
    .span2,.span3,.span4,.span5,.span7{grid-column:span 12 !important;}
  }

  @media print{
    body{background:#fff;color:#000}
    .card{background:#fff;border:1px solid #ddd}
    .no-print{display:none !important}
    th{background:#f3f3f3;color:#000}
    .muted{color:#444}
    .good,.bad{color:#000}
  }
</style>
</head>

<body>
<div class="wrap">

  <!-- Header -->
  <div class="card">
    <div class="row">
      <div class="span4" style="grid-column:span 4">
        <label>Employee name</label>
        <input id="emp" placeholder="e.g., John Smith">
      </div>
      <div class="span4" style="grid-column:span 4">
        <label>Pay period</label>
        <input id="period" placeholder="e.g., 12/1–12/15">
      </div>
      <div class="span2" style="grid-column:span 2">
        <label>Base hourly rate</label>
        <input id="rate" type="number" step="0.01" min="0" placeholder="e.g., 22.50">
      </div>
      <div class="span2" style="grid-column:span 2">
        <label>Overall clocked hours</label>
        <input id="clocked" type="number" step="0.01" min="0" placeholder="e.g., 80">
      </div>
    </div>

   <div class="btnbar no-print" style="margin-top:12px">
  <button class="secondary" type="button" onclick="printPDF()">Export / Print PDF</button>
  <button class="secondary" type="button" onclick="downloadCSV()">Download CSV</button>
  <button class="secondary" type="button" onclick="downloadJSON()">Download JSON</button>
  <button class="secondary" type="button" onclick="resetAll()">Clear</button>
</div>


    </div>
  </div>

  <!-- Add Job -->
  <div class="card no-print">
    <div class="row">
      <div class="span5" style="grid-column:span 5">
        <label>Job name / number</label>
        <input id="jobName" placeholder="e.g., #1042 – Smith House">
      </div>
      <div class="span2" style="grid-column:span 2">
        <label>Job amount ($)</label>
        <input id="jobAmount" type="number" step="0.01" min="0" placeholder="e.g., 5000">
      </div>
      <div class="span2" style="grid-column:span 2">
        <label>Payout %</label>
        <input id="jobPct" type="number" step="0.01" min="0" placeholder="e.g., 8">
      </div>
      <div class="span2" style="grid-column:span 2">
        <label>Job hours (compare only)</label>
        <input id="jobHours" type="number" step="0.01" min="0" placeholder="e.g., 12.5">
      </div>
      <div style="grid-column:span 1">
        <button type="button" onclick="addJob()" style="width:100%">Add</button>
      </div>
    </div>
  </div>

  <!-- Jobs Table -->
  <div class="card">
    <div class="muted">Performance Pay per job = <b>Job Amount × Payout %</b> (Job hours are comparison-only)</div>
    <table>
      <thead>
        <tr>
          <th>Job</th>
          <th class="right">Job $</th>
          <th class="right">Payout %</th>
          <th class="right">Performance pay</th>
          <th class="right">Job hours</th>
          <th class="right no-print"></th>
        </tr>
      </thead>
      <tbody id="jobs"></tbody>
      <tfoot>
        <tr>
          <td class="muted"><b>Totals</b></td>
          <td></td><td></td>
          <td class="right" id="perfTotal">$0.00</td>
          <td class="right" id="jobHoursTotal">0.00</td>
          <td class="no-print"></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Penalties -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:baseline;">
      <div><b>Infractions / Penalties</b> <span class="muted">(deducted from performance bonus)</span></div>
      <div class="muted">Total penalties: <b id="penTotalBadge">$0.00</b></div>
    </div>

    <div class="row no-print" style="margin-top:10px">
      <div class="span7" style="grid-column:span 7">
        <label>Infraction / note</label>
        <input id="penNote" placeholder="e.g., Late arrival, damaged material, callback...">
      </div>
      <div class="span3" style="grid-column:span 3">
        <label>Penalty amount ($)</label>
        <input id="penAmount" type="number" step="0.01" min="0" placeholder="e.g., 25">
      </div>
      <div class="span2" style="grid-column:span 2">
        <button type="button" onclick="addPenalty()" style="width:100%">Add</button>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Infraction / note</th>
          <th class="right">Amount</th>
          <th class="right no-print"></th>
        </tr>
      </thead>
      <tbody id="penalties"></tbody>
      <tfoot>
        <tr>
          <td class="muted"><b>Total penalties</b></td>
          <td class="right" id="penTotalFoot">$0.00</td>
          <td class="no-print"></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Summary -->
  <div class="card">
    <b>Summary</b>
    <div id="summary" class="muted" style="margin-top:8px"></div>
  </div>

</div>

<script>
  // State
  let jobs = [];
  let penalties = [];

  const $ = (id) => document.getElementById(id);
  const money = (n) => new Intl.NumberFormat("en-US", { style:"currency", currency:"USD" }).format(Number(n || 0));
  const num = (v) => {
    const x = Number(v);
    return Number.isFinite(x) ? x : 0;
  };
  const esc = (s) =>
    String(s ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");

  function printPDF(){
    // ensure current values are reflected before print
    render();
    window.print();
  }

  function addJob(){
    const name = $("jobName").value.trim();
    const amount = num($("jobAmount").value);
    const pct = num($("jobPct").value) / 100;
    const hrs = num($("jobHours").value);

    if (!name) return alert("Enter job name/number.");
    if (amount <= 0) return alert("Job amount must be > 0.");
    if (pct < 0) return alert("Payout % cannot be negative.");
    if (hrs < 0) return alert("Job hours cannot be negative.");

    jobs.push({ name, amount, pct, hrs });

    $("jobName").value = "";
    $("jobAmount").value = "";
    $("jobPct").value = "";
    $("jobHours").value = "";

    render();
  }

  function removeJob(idx){
    jobs.splice(idx, 1);
    render();
  }

  function addPenalty(){
    const note = $("penNote").value.trim();
    const amount = num($("penAmount").value);

    if (amount <= 0) return alert("Penalty amount must be > 0.");

    penalties.push({ note: note || "Penalty", amount });

    $("penNote").value = "";
    $("penAmount").value = "";

    render();
  }

  function removePenalty(idx){
    penalties.splice(idx, 1);
    render();
  }

  function calc(){
    // Performance Pay = sum(job amount * payout%)
    let performancePay = 0;
    let jobHoursTotal = 0;
    for (const j of jobs){
      performancePay += j.amount * j.pct;
      jobHoursTotal += j.hrs;
    }

    // Penalties total
    let penTotal = 0;
    for (const p of penalties) penTotal += p.amount;

    // Base + bonus model
    const clocked = num($("clocked").value);
    const rate = num($("rate").value);

    const basePay = clocked * rate;                    // reference
    const bonusGross = performancePay - basePay;       // before penalties
    const bonusNet = bonusGross - penTotal;            // deduct penalties
    const totalPayout = basePay + bonusNet;            // = performancePay - penalties
    const overallHourly = clocked > 0 ? totalPayout / clocked : 0;

    return { performancePay, jobHoursTotal, penTotal, clocked, rate, basePay, bonusGross, bonusNet, totalPayout, overallHourly };
  }

  function render(){
    const t = calc();

    // Render jobs
    $("jobs").innerHTML = "";
    jobs.forEach((j, i) => {
      const perf = j.amount * j.pct;
      $("jobs").innerHTML += `
        <tr>
          <td>${esc(j.name)}</td>
          <td class="right">${money(j.amount)}</td>
          <td class="right">${(j.pct * 100).toFixed(2)}%</td>
          <td class="right">${money(perf)}</td>
          <td class="right">${j.hrs.toFixed(2)}</td>
          <td class="right no-print"><button class="small" type="button" onclick="removeJob(${i})">✕</button></td>
        </tr>
      `;
    });

    $("perfTotal").textContent = money(t.performancePay);
    $("jobHoursTotal").textContent = t.jobHoursTotal.toFixed(2);

    // Render penalties
    $("penalties").innerHTML = "";
    penalties.forEach((p, i) => {
      $("penalties").innerHTML += `
        <tr>
          <td>${esc(p.note)}</td>
          <td class="right">${money(p.amount)}</td>
          <td class="right no-print"><button class="small" type="button" onclick="removePenalty(${i})">✕</button></td>
        </tr>
      `;
    });

    $("penTotalBadge").textContent = money(t.penTotal);
    $("penTotalFoot").textContent = money(t.penTotal);

    // Summary
    const diff = t.clocked - t.jobHoursTotal;
    const hourlyClass = t.overallHourly >= t.rate ? "good" : "bad";

    $("summary").innerHTML = `
      Base pay (reference): <b>${money(t.basePay)}</b><br>
      Performance pay: <b>${money(t.performancePay)}</b><br>
      Performance bonus (before penalties): <b class="${t.bonusGross >= 0 ? "good" : "bad"}">${money(t.bonusGross)}</b><br>
      Penalties deducted: <b class="bad">-${money(t.penTotal)}</b><br>
      Performance bonus (net): <b class="${t.bonusNet >= 0 ? "good" : "bad"}">${money(t.bonusNet)}</b>
      <hr>
      <b>Total payout:</b> ${money(t.totalPayout)}<br>
      <b>Overall hourly pay:</b> <b class="${hourlyClass}">${money(t.overallHourly)}/hr</b>
      <br><br>
      Hours check — Clocked: ${t.clocked.toFixed(2)} | Job hours: ${t.jobHoursTotal.toFixed(2)} | Diff: ${diff.toFixed(2)}
    `;
  }

  function resetAll(){
    if(!confirm("Clear all jobs, penalties, and values?")) return;
    jobs = [];
    penalties = [];
    document.querySelectorAll("input").forEach(i => i.value = "");
    render();
  }

  // Recalc when base inputs change
  ["emp","period","rate","clocked"].forEach(id => $(id).addEventListener("input", render));

  // initial render
  render();
  function filenameBase(){
  const emp = ($("emp").value || "").trim().replace(/[^a-z0-9]+/gi, "-").replace(/^-+|-+$/g, "");
  const per = ($("period").value || "").trim().replace(/[^a-z0-9]+/gi, "-").replace(/^-+|-+$/g, "");
  const stamp = new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");
  const bits = ["performance-pay", emp || "employee", per || "period", stamp].filter(Boolean);
  return bits.join("_");
}

function downloadCSV(){
  const t = calc();

  // Build rows for a payroll-friendly export
  const rows = [];
  rows.push(["Employee", $("emp").value || ""]);
  rows.push(["Pay Period", $("period").value || ""]);
  rows.push([]);

  rows.push(["Base Hourly Rate", t.rate]);
  rows.push(["Overall Clocked Hours", t.clocked]);
  rows.push(["Base Pay (reference)", t.basePay]);
  rows.push(["Performance Pay", t.performancePay]);
  rows.push(["Penalties Total", t.penTotal]);
  rows.push(["Performance Bonus (gross)", t.bonusGross]);
  rows.push(["Performance Bonus (net)", t.bonusNet]);
  rows.push(["Total Payout", t.totalPayout]);
  rows.push(["Overall Hourly Pay", t.overallHourly]);
  rows.push([]);

  rows.push(["JOBS"]);
  rows.push(["Job", "Job Amount", "Payout %", "Performance Pay", "Job Hours (compare only)"]);
  jobs.forEach(j => {
    rows.push([
      j.name,
      j.amount,
      (j.pct * 100).toFixed(2) + "%",
      (j.amount * j.pct),
      j.hrs
    ]);
  });

  rows.push([]);
  rows.push(["PENALTIES"]);
  rows.push(["Note", "Amount"]);
  penalties.forEach(p => {
    rows.push([p.note, p.amount]);
  });

  const csv = rows.map(r =>
    r.map(v => `"${String(v ?? "").replace(/"/g,'""')}"`).join(",")
  ).join("\n");

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `${filenameBase()}.csv`;
  document.body.appendChild(a);
  a.click();
  a.remove();

  URL.revokeObjectURL(url);
}

function downloadJSON(){
  const t = calc();

  const payload = {
    employee: ($("emp").value || "").trim(),
    payPeriod: ($("period").value || "").trim(),
    baseHourlyRate: t.rate,
    overallClockedHours: t.clocked,
    totals: {
      basePayReference: t.basePay,
      performancePay: t.performancePay,
      penaltiesTotal: t.penTotal,
      performanceBonusGross: t.bonusGross,
      performanceBonusNet: t.bonusNet,
      totalPayout: t.totalPayout,
      overallHourlyPay: t.overallHourly
    },
    jobs: jobs.map(j => ({
      name: j.name,
      jobAmount: j.amount,
      payoutPercent: +(j.pct * 100).toFixed(4),
      performancePay: +(j.amount * j.pct).toFixed(2),
      jobHoursCompareOnly: j.hrs
    })),
    penalties: penalties.map(p => ({
      note: p.note,
      amount: p.amount
    })),
    generatedAt: new Date().toISOString()
  };

  const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `${filenameBase()}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();

  URL.revokeObjectURL(url);
}

</script>
</body>
</html>


